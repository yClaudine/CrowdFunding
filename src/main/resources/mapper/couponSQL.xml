<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="coupon">
  <select id="selectAllCoupon" resultType="coupon" >
  	select
  		coupon_no as couponNo,
  		coupon_name as couponName,
  		coupon_type as couponType,
  		discount,
  		main_target as mainTarget,
  		sub_target as subTarget,
  		valid_start as validStart,
  		valid_end as validEnd,
  		min_price as minPrice,
  		coupon_status as couponStatus
  	from coupon order by 1 desc
  </select>
  <insert id="insertCoupon" parameterType="coupon">
  	insert into coupon values(
  		coupon_seq.nextval,
  		#{couponName},
  		#{couponType},
  		#{discount},
  		#{mainTarget},
  		#{subTarget},
  		#{validStart},
  		#{validEnd},
  		#{minPrice},
  		0
  	)
  	
  </insert>
  <select id="selectOneCoupon" parameterType="int" resultType="coupon">
  	select
  		coupon_no as couponNo,
  		coupon_name as couponName,
  		coupon_type as couponType,
  		discount,
  		main_target as mainTarget,
  		sub_target as subTarget,
  		valid_start as validStart,
  		valid_end as validEnd,
  		min_price as minPrice,
  		coupon_status as couponStatus
  	from coupon where coupon_no=#{couponNo}
  </select>
  <update id="updateCoupon" parameterType="coupon">
  	update coupon set
  		coupon_name = #{couponName},
  		coupon_type = #{couponType},
  		discount = #{discount},
  		main_target = #{mainTarget},
  		sub_target = #{subTarget},
  		valid_start = #{validStart},
  		valid_end = #{validEnd},
  		min_price = #{minPrice},
  		coupon_status = 0
	where coupon_no= #{couponNo}
  </update>
  <delete id="deleteCoupon" parameterType="int">
  	delete from coupon where coupon_no=#{couponNo}
  </delete>
  <update id="expireCoupon" parameterType="string">
  	update coupon set coupon_status = 2 where valid_end=#{todayString}
  </update>
  <update id="expireMemberCoupon" parameterType="string">
  	update member_coupon set coupon_status=1 where valid_end=#{todayString}
  </update>
</mapper>
