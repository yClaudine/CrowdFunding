<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="fundPay">
	<select id="selectMemberCouponList" parameterType="int" resultType="mc">
		select
  		mem_coupon_no as memCouponNo,
  		member_no as memberNo,
  		use_date as useDate,
  		coupon_use as couponUse,
  		coupon_status as couponStatus,
  		coupon_no as couponNo,
  		valid_end as validEnd
  		from member_coupon
		where member_no=#{memberNo} and coupon_use=0 and coupon_status=0 
	</select>
	<select id="selectOneCoupon" parameterType="map" resultType="coupon">
		select
		coupon_no as couponNo,
  		coupon_name as couponName,
  		coupon_type as couponType,
  		discount,
  		main_target as mainTarget,
  		sub_target as subTarget,
  		valid_start as validStart,
  		valid_end as validEnd,
  		min_price as minPrice,
  		coupon_status as couponStatus
  		from coupon 
		where coupon_no=#{couponNo} and main_target in ('all','fund') 
		and 
		<choose>
			<when test="fundCategory.equals('푸드')">
			sub_target in ('all','food') 			
			</when>
			<when test="fundCategory.equals('뷰티')">
			sub_target in ('all','beauty') 			
			</when>
			<when test="fundCategory.equals('반려동물')">
			sub_target in ('all','pet') 			
			</when>
			<when test="fundCategory.equals('여행')">
			sub_target in ('all','travel') 			
			</when>
			<when test="fundCategory.equals('리빙')">
			sub_target in ('all','living') 			
			</when>
		</choose>
		and #{rewardSum} <![CDATA[>]]> min_price	
	</select>
</mapper>
